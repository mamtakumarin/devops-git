version 4 from mergeconflict branch